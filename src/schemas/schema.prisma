
generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "sqlite"
    url = "file:./dev.db"
}

model User {
    id Int @id @default(autoincrement())
    email String @unique
    password String
    userName String 
    role userRole @default(STUDENT)
    isAdmin Boolean @default(false)

    Groups Member[]
    sentMessages Message[] @relation(name: "sent")
    recievedMessages Message[] @relation(name: "received")

    @@map("users")
}

model Member {
    id Int @id @default(autoincrement())

    chat_id Int
    user_Id Int

    messages GroupMessage[]

    user User @relation(references: [id], fields: [user_Id])
    group Group @relation(references: [id], fields: [chat_id])

    @@unique([user_Id, chat_id])
    @@map("members")
}

model GroupMessage {
    id Int @id @default(autoincrement())

    chat_id Int
    owner_id Int

    group Group @relation(references: [id], fields: [chat_id])
    owner Member @relation(references: [id], fields: [owner_id])


    type messageType @default(TEXT)
    content String

    @@map("GroupMessages")
}

model Group {
    id Int @id @default(autoincrement())
    name String
    members Member[]
    messages GroupMessage[]

    @@map("Groups")
}

model Message {
    id Int @id @default(autoincrement())
    type messageType @default(TEXT)
    text String

    sender_id Int
    reciever_id Int

    sender User @relation(name: "sent", references: [id], fields: [sender_id])
    reciever User @relation(name: "received", references: [id], fields: [reciever_id])
    @@map("Messages")
}


enum userRole {
    TEACHER
    STUDENT
}

enum messageType {
    TEXT
    IMAGE
    DOCUMENT
}